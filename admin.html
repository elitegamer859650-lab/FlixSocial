<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - FlixSocial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        .nav-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .sidebar-item:hover { background-color: #3B82F6; color: white; }
        .stats-card { transition: all 0.3s ease; }
        .stats-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Admin Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-xl p-8 w-96">
            <h2 class="text-2xl font-bold mb-6 text-center">Admin Login</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="adminEmail" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="admin@flixsocial.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="adminPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter password">
                </div>
                <button id="loginBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-md font-medium">
                    Sign In
                </button>
                <p id="loginError" class="text-red-500 text-sm text-center mt-2 hidden"></p>
            </div>
        </div>
    </div>

    <!-- Admin Panel (Hidden until login) -->
    <div id="adminPanel" class="hidden">
        <!-- Header -->
        <header class="nav-gradient text-white shadow-lg">
            <div class="container mx-auto">
                <div class="flex justify-between items-center p-4">
                    <div class="flex items-center">
                        <i class="fas fa-cog text-2xl mr-2 text-yellow-300"></i>
                        <h1 class="text-xl font-bold">FlixSocial Admin Panel</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="adminWelcome" class="font-medium">Welcome, Admin</span>
                        <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto p-4 mt-4">
            <!-- Stats Overview -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="stats-card bg-white rounded-xl shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-blue-500 mb-2" id="totalUsers">0</div>
                    <div class="text-gray-600">Total Users</div>
                </div>
                <div class="stats-card bg-white rounded-xl shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-green-500 mb-2" id="totalVideos">0</div>
                    <div class="text-gray-600">Total Videos</div>
                </div>
                <div class="stats-card bg-white rounded-xl shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-purple-500 mb-2" id="totalViews">0</div>
                    <div class="text-gray-600">Total Views</div>
                </div>
                <div class="stats-card bg-white rounded-xl shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-yellow-500 mb-2" id="totalLikes">0</div>
                    <div class="text-gray-600">Total Likes</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="bg-white rounded-xl shadow-lg mb-6">
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-8 px-6">
                        <button id="usersTab" class="py-4 border-b-2 border-blue-500 text-blue-500 font-medium">Users</button>
                        <button id="videosTab" class="py-4 text-gray-500 hover:text-blue-500 font-medium">Videos</button>
                        <button id="analyticsTab" class="py-4 text-gray-500 hover:text-blue-500 font-medium">Analytics</button>
                    </nav>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="usersContent" class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">User Management</h2>
                    <div class="relative">
                        <input type="text" placeholder="Search users..." class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4">User</th>
                                <th class="text-left py-3 px-4">Email</th>
                                <th class="text-left py-3 px-4">Joined</th>
                                <th class="text-left py-3 px-4">Videos</th>
                                <th class="text-left py-3 px-4">Status</th>
                                <th class="text-left py-3 px-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Videos Tab -->
            <div id="videosContent" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Video Management</h2>
                    <div class="flex space-x-3">
                        <div class="relative">
                            <input type="text" placeholder="Search videos..." class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                        </div>
                        <select class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option>All Categories</option>
                            <option>Technology</option>
                            <option>Entertainment</option>
                            <option>Education</option>
                            <option>Gaming</option>
                        </select>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4">Video</th>
                                <th class="text-left py-3 px-4">Uploader</th>
                                <th class="text-left py-3 px-4">Views</th>
                                <th class="text-left py-3 px-4">Likes</th>
                                <th class="text-left py-3 px-4">Uploaded</th>
                                <th class="text-left py-3 px-4">Status</th>
                                <th class="text-left py-3 px-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="videosTable">
                            <!-- Videos will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analyticsContent" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <h2 class="text-xl font-bold mb-6">Platform Analytics</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h3 class="font-bold mb-4">Top Videos</h3>
                        <div id="topVideosList">
                            <!-- Top videos will be loaded here -->
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h3 class="font-bold mb-4">Recent Activity</h3>
                        <div id="recentActivity">
                            <!-- Recent activity will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA8CjkoY0ygW4lhpTn_-BKOI9DjHqqFXBs",
            authDomain: "heroflix-d64ac.firebaseapp.com",
            databaseURL: "https://heroflix-d64ac-default-rtdb.firebaseio.com",
            projectId: "heroflix-d64ac",
            storageBucket: "heroflix-d64ac.firebasestorage.app",
            messagingSenderId: "451233952566",
            appId: "1:451233952566:web:1ecd9f7066d5e7cab77997"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Admin credentials
        const ADMIN_EMAIL = "mgpspport@gmail.com";
        const ADMIN_PASSWORD = "acer4321234@";

        // DOM Elements
        const loginModal = document.getElementById('loginModal');
        const adminPanel = document.getElementById('adminPanel');
        const adminEmail = document.getElementById('adminEmail');
        const adminPassword = document.getElementById('adminPassword');
        const loginBtn = document.getElementById('loginBtn');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminWelcome = document.getElementById('adminWelcome');

        // Tab elements
        const usersTab = document.getElementById('usersTab');
        const videosTab = document.getElementById('videosTab');
        const analyticsTab = document.getElementById('analyticsTab');
        const usersContent = document.getElementById('usersContent');
        const videosContent = document.getElementById('videosContent');
        const analyticsContent = document.getElementById('analyticsContent');

        // Check if already logged in
        if (localStorage.getItem('adminLoggedIn') === 'true') {
            loginModal.classList.add('hidden');
            adminPanel.classList.remove('hidden');
            loadAdminData();
        }

        // Login functionality
        loginBtn.addEventListener('click', () => {
            const email = adminEmail.value;
            const password = adminPassword.value;

            if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                // Successful login
                localStorage.setItem('adminLoggedIn', 'true');
                loginModal.classList.add('hidden');
                adminPanel.classList.remove('hidden');
                adminWelcome.textContent = `Welcome, ${email}`;
                loadAdminData();
            } else {
                loginError.textContent = 'Invalid email or password';
                loginError.classList.remove('hidden');
            }
        });

        // Logout functionality
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('adminLoggedIn');
            adminPanel.classList.add('hidden');
            loginModal.classList.remove('hidden');
            adminEmail.value = '';
            adminPassword.value = '';
            loginError.classList.add('hidden');
        });

        // Tab switching
        usersTab.addEventListener('click', () => switchTab('users'));
        videosTab.addEventListener('click', () => switchTab('videos'));
        analyticsTab.addEventListener('click', () => switchTab('analytics'));

        function switchTab(tab) {
            // Reset all tabs
            usersTab.classList.remove('border-b-2', 'border-blue-500', 'text-blue-500');
            videosTab.classList.remove('border-b-2', 'border-blue-500', 'text-blue-500');
            analyticsTab.classList.remove('border-b-2', 'border-blue-500', 'text-blue-500');
            
            usersTab.classList.add('text-gray-500');
            videosTab.classList.add('text-gray-500');
            analyticsTab.classList.add('text-gray-500');

            // Hide all content
            usersContent.classList.add('hidden');
            videosContent.classList.add('hidden');
            analyticsContent.classList.add('hidden');

            // Activate selected tab
            if (tab === 'users') {
                usersTab.classList.add('border-b-2', 'border-blue-500', 'text-blue-500');
                usersTab.classList.remove('text-gray-500');
                usersContent.classList.remove('hidden');
                loadUsers();
            } else if (tab === 'videos') {
                videosTab.classList.add('border-b-2', 'border-blue-500', 'text-blue-500');
                videosTab.classList.remove('text-gray-500');
                videosContent.classList.remove('hidden');
                loadVideos();
            } else if (tab === 'analytics') {
                analyticsTab.classList.add('border-b-2', 'border-blue-500', 'text-blue-500');
                analyticsTab.classList.remove('text-gray-500');
                analyticsContent.classList.remove('hidden');
                loadAnalytics();
            }
        }

        // Load admin data
        async function loadAdminData() {
            try {
                // Load users
                const usersRef = database.ref('users');
                usersRef.on('value', (snapshot) => {
                    const users = snapshot.val();
                    const userCount = users ? Object.keys(users).length : 0;
                    document.getElementById('totalUsers').textContent = userCount;
                });

                // Load videos
                const videosRef = database.ref('videos');
                videosRef.on('value', (snapshot) => {
                    const videos = snapshot.val();
                    const videoCount = videos ? Object.keys(videos).length : 0;
                    let totalViews = 0;
                    let totalLikes = 0;

                    if (videos) {
                        Object.values(videos).forEach(video => {
                            totalViews += video.views || 0;
                            totalLikes += video.likes || 0;
                        });
                    }

                    document.getElementById('totalVideos').textContent = videoCount;
                    document.getElementById('totalViews').textContent = totalViews.toLocaleString();
                    document.getElementById('totalLikes').textContent = totalLikes.toLocaleString();
                });

            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        // Load users for management
        async function loadUsers() {
            try {
                const usersRef = database.ref('users');
                const snapshot = await usersRef.once('value');
                const users = snapshot.val();
                const usersTable = document.getElementById('usersTable');

                usersTable.innerHTML = '';

                if (!users) {
                    usersTable.innerHTML = '<tr><td colspan="6" class="py-4 text-center text-gray-500">No users found</td></tr>';
                    return;
                }

                Object.entries(users).forEach(([userId, user]) => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="py-3 px-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-sm">
                                    ${user.name ? user.name.charAt(0).toUpperCase() : 'U'}
                                </div>
                                <div>
                                    <div class="font-medium">${user.name || 'Unknown User'}</div>
                                    <div class="text-gray-500 text-sm">@${user.username || 'user'}</div>
                                </div>
                            </div>
                        </td>
                        <td class="py-3 px-4">${user.email || 'No email'}</td>
                        <td class="py-3 px-4">${user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'Unknown'}</td>
                        <td class="py-3 px-4">${user.videoCount || 0}</td>
                        <td class="py-3 px-4">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Active</span>
                        </td>
                        <td class="py-3 px-4">
                            <div class="flex space-x-2">
                                <button onclick="editUser('${userId}')" class="text-blue-500 hover:text-blue-700">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteUser('${userId}')" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    usersTable.appendChild(row);
                });

            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Load videos for management
        async function loadVideos() {
            try {
                const videosRef = database.ref('videos');
                const snapshot = await videosRef.once('value');
                const videos = snapshot.val();
                const videosTable = document.getElementById('videosTable');

                videosTable.innerHTML = '';

                if (!videos) {
                    videosTable.innerHTML = '<tr><td colspan="7" class="py-4 text-center text-gray-500">No videos found</td></tr>';
                    return;
                }

                Object.entries(videos).forEach(([videoId, video]) => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="py-3 px-4">
                            <div class="flex items-center space-x-3">
                                <img src="${video.thumbnail || 'https://placehold.co/60x40/667eea/ffffff?text=Video'}" 
                                     alt="Thumbnail" class="w-15 h-10 object-cover rounded">
                                <div class="max-w-xs">
                                    <div class="font-medium truncate">${video.title || 'Untitled Video'}</div>
                                    <div class="text-gray-500 text-sm truncate">${video.description || 'No description'}</div>
                                </div>
                            </div>
                        </td>
                        <td class="py-3 px-4">${video.uploadedByName || 'Unknown User'}</td>
                        <td class="py-3 px-4">${video.views || 0}</td>
                        <td class="py-3 px-4">${video.likes || 0}</td>
                        <td class="py-3 px-4">${video.uploadedAt ? new Date(video.uploadedAt).toLocaleDateString() : 'Unknown'}</td>
                        <td class="py-3 px-4">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Approved</span>
                        </td>
                        <td class="py-3 px-4">
                            <div class="flex space-x-2">
                                <button onclick="editVideo('${videoId}')" class="text-blue-500 hover:text-blue-700">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteVideo('${videoId}')" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button onclick="viewVideo('${videoId}')" class="text-green-500 hover:text-green-700">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    videosTable.appendChild(row);
                });

            } catch (error) {
                console.error('Error loading videos:', error);
            }
        }

        // Load analytics data
        async function loadAnalytics() {
            // This would typically load charts and detailed analytics
            document.getElementById('topVideosList').innerHTML = `
                <div class="space-y-3">
                    <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                        <div class="font-medium">React Basics Tutorial</div>
                        <div class="text-blue-500 font-bold">12.5K views</div>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                        <div class="font-medium">Cooking Masterclass</div>
                        <div class="text-blue-500 font-bold">8.7K views</div>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                        <div class="font-medium">Gaming Highlights</div>
                        <div class="text-blue-500 font-bold">6.3K views</div>
                    </div>
                </div>
            `;

            document.getElementById('recentActivity').innerHTML = `
                <div class="space-y-3">
                    <div class="p-3 bg-white rounded-lg shadow-sm">
                        <div class="font-medium">New user registered</div>
                        <div class="text-gray-500 text-sm">2 minutes ago</div>
                    </div>
                    <div class="p-3 bg-white rounded-lg shadow-sm">
                        <div class="font-medium">Video uploaded</div>
                        <div class="text-gray-500 text-sm">15 minutes ago</div>
                    </div>
                    <div class="p-3 bg-white rounded-lg shadow-sm">
                        <div class="font-medium">User reported content</div>
                        <div class="text-gray-500 text-sm">1 hour ago</div>
                    </div>
                </div>
            `;
        }

        // Admin functions
        window.editUser = function(userId) {
            alert(`Edit user: ${userId}`);
            // Implement user editing functionality
        }

        window.deleteUser = function(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                database.ref('users/' + userId).remove()
                    .then(() => {
                        alert('User deleted successfully');
                        loadUsers();
                    })
                    .catch(error => {
                        alert('Error deleting user: ' + error.message);
                    });
            }
        }

        window.editVideo = function(videoId) {
            const newTitle = prompt('Enter new title:');
            if (newTitle) {
                database.ref('videos/' + videoId).update({
                    title: newTitle
                }).then(() => {
                    alert('Video title updated successfully');
                    loadVideos();
                });
            }
        }

        window.deleteVideo = function(videoId) {
            if (confirm('Are you sure you want to delete this video?')) {
                database.ref('videos/' + videoId).remove()
                    .then(() => {
                        alert('Video deleted successfully');
                        loadVideos();
                    })
                    .catch(error => {
                        alert('Error deleting video: ' + error.message);
                    });
            }
        }

        window.viewVideo = function(videoId) {
            window.open(`video-player.html?id=${videoId}`, '_blank');
        }

        // Initialize with users tab
        switchTab('users');
    </script>
</body>
</html>
